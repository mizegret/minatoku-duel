#!/usr/bin/env sh

# Ensure exec bits on staged hooks/scripts
node scripts/fix-exec.mjs --staged || true

# Security: block obvious secrets before any commit
node scripts/guard-secrets.mjs || exit 1

npx --no-install lint-staged --config .lintstagedrc.json

# 粒度チェック（大きすぎるコミットを防止）
"$(git rev-parse --show-toplevel)/scripts/check-granularity.sh" || exit 1

# ロックファイル同期チェック（package.jsonを変えたらpackage-lock.jsonも必須）
node scripts/check-lock-sync.mjs || exit 1

# インタラクティブ自己レビュー（yes で続行）
"$(git rev-parse --show-toplevel)/scripts/self-review.sh" || exit 1
